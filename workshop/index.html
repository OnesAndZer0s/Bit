<html>
  <head>
    <title>Bit - Workshop</title>
    <script src="../Blockly/blockly_compressed.js"></script>
    <script src="../Blockly/blocks_compressed.js"></script>
    <script src="../Blockly/javascript_compressed.js"></script>
    <script src="../Blockly/msg/en.js"></script>
    <script src="workshop_blocks.js"></script>
    <script src="../functions.js"></script>
  </head>
   
  <body>
<table id="blocklyWorkshop" style="width:100%; height:100%">
	<tbody>
		<tr width="100%" height="10%"></tr>
		<tr width="100%" height="90%">
			<td width="50%">
				<div id="blocklyDefine" style="height:870px"></div>
			</td>
			<td width="50%">
				<table style="width: 100%; height: 870px;">
					<tbody>
						<tr>
							<td height="5%">PREVIEW</td>
						</tr>
						<tr>
							<td height="35%">
								<div id="blocklyPreview" style="height: 300px"></div>
							</td>
						</tr>
						<tr>
							<td height="5%">DEFINITION</td>
						</tr>
						<tr>
							<td height="25%" width="100%">
								<textarea id="blockDef" style="width: inherit; height: 210px; resize:none"></textarea>
							</td>
						</tr>
						<tr>
							<td height="5%">CODE</td>
						</tr>
						<tr>
							<td height="25%" width="100%">
								<textarea id="blockCode" style="width: inherit; height: 210px; resize:none"></textarea>
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody>	  
</table>

<xml id="toolbox" style="display: none">
	<category name="Block">
		<category name="Get"></category>
		<category name="Set">
			<block type="workshop_settooltip"></block>
			<block type="workshop_sethelpurl"></block>
			<block type="workshop_setoutput"></block>
			<block type="workshop_setpreviousstatement"></block>
			<block type="workshop_setnextstatement"></block>
			<block type="workshop_setcolor"></block>
			<block type="workshop_setcomment"></block>
			<block type="workshop_setconnectionshidden"></block>
			<block type="workshop_setdeletable"></block>
			<block type="workshop_setdisabled"></block>
			<block type="workshop_setinputsinline"></block>
			<block type="workshop_setinsertionmarker"></block>
			<block type="workshop_setmoveable"></block>
			<block type="workshop_setshadow"></block>
			<block type="workshop_setwarningtext"></block>
			<block type="workshop_setcollapsed"></block>
		</category>
		<category name="Input">
			<block type="workshop_appenddummyinput"></block>
			<block type="workshop_appendstatementinput"></block>
			<block type="workshop_appendvalueinput"></block>
			<block type="workshop_fieldsetvisible"></block>
			<block type="workshop_fieldsetalign"></block>
			<block type="workshop_fieldremove"></block>
			<block type="workshop_fielddispose"></block>
			<block type="workshop_field"></block>
		</category>
		<block type="workshop_dispose"></block>
	</category>
	<category name="Logic"></category>
	<category name="Variables" custom="VARIABLE"></category>
        <category name="Functions" custom="PROCEDURE"></category>
</xml>
<script>
  
var pre = initBlockly("blocklyPreview", {
  collapse : false, 
	comments : false, 
	disable : false, 
	maxBlocks : Infinity, 
	trashcan : false, 
	horizontalLayout : false, 
	toolboxPosition : 'start', 
	css : true, 
	scrollbars : true, 
	sounds : true, 
	oneBasedIndex : false, 
	grid : {
		spacing : 25, 
		length : 1, 
		colour : '#555', 
		snap : false
	}, 
	zoom : {
		controls : true, 
		wheel : true, 
		startScale : 1, 
		maxScale : 1.5, 
		minScale : 0.2, 
		scaleSpeed : 1.2
	}
});
	
var preBlock = pre.newBlock('workshop_demo',"pre");
preBlock.initSvg();
preBlock.render();

pre.centerOnBlock("pre");
	

var define = initBlockly("blocklyDefine", {
  toolbox: document.getElementById('toolbox'),
  collapse : false, 
	comments : true, 
	disable : true, 
	maxBlocks : Infinity, 
	trashcan : true, 
	horizontalLayout : false, 
	toolboxPosition : 'start', 
	css : true, 
	scrollbars : true, 
	sounds : true, 
	oneBasedIndex : false, 
	grid : {
		spacing : 20, 
		length : 1, 
		colour : '#888', 
		snap : false
	}, 
	zoom : {
		controls : true, 
		wheel : true, 
		startScale : 1, 
		maxScale : 1.5, 
		minScale : 0.2, 
		scaleSpeed : 1.2
	}
}, function(code) {
if (code !== "") {
var c = code.split('\u001F'); 
document.getElementById('blockDef').value = c[1]; 
document.getElementById('blockCode').value =  c[2]; 
//console.log(c[0]);
//console.log(c[1]);
//console.log(c[2]);
	
eval(c[1]);
eval(c[2]);

preBlock.dispose();
preBlock = pre.newBlock(c[0],"pre");
preBlock.initSvg();
preBlock.render();
//console.log(code);
}
});
	
document.getElementById("blockDef").oninput = function(input){
	
console.log(input.data,this.innerHTML);
}
	
	

  var main = define.newBlock('workshop_block_description',"desc");
  main.initSvg();
  main.render();
  main.setDeletable(false);
  main.setMovable(false);
	
  define.centerOnBlock("desc");
  define.addChangeListener(Blockly.Events.disableOrphans);	
	
</script>
  </body>


</html>
